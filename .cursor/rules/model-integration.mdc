# 模型集成规范

## 支持的模型

### 文生图
- `wan2.6-t2i` - 万相 2.6 文生图
- `wan2.5-t2i-preview` - 万相 2.5 文生图

### 图生图
- `wan2.5-i2i-preview` - 万相 2.5 图生图

### 图生视频
- `wan2.6-i2v` - 万相 2.6 图生视频
- `wan2.5-i2v-preview` - 万相 2.5 图生视频

### 首尾帧生视频
- `wan2.6-flf2v` - 万相 2.6 首尾帧生视频

### 视频生视频
- `wan2.6-r2v` - 万相 2.6 参考视频生视频

### 图像编辑
- `qwen-image-edit-plus` - 通义千问图像编辑

## 添加新模型步骤

### 1. 配置定义
在 `backend/app/config.py` 中添加模型配置：
```python
class ImageConfig(BaseModel):
    model: str = "wan2.6-t2i"
    width: int = 1440
    height: int = 810
    # ...
```

### 2. 服务实现
在 `backend/app/services/dashscope/` 下创建服务：
```python
class NewModelService:
    async def generate(
        self,
        prompt: str,
        project_id: str = "",  # 必须支持
        **kwargs
    ) -> str:
        # 1. 调用 DashScope API
        # 2. 处理 OSS 上传
        # 3. 返回结果 URL
        pass
```

### 3. 路由集成
在对应路由中调用服务：
```python
@router.post("/generate")
async def generate(request: GenerateRequest):
    service = NewModelService()
    result = await service.generate(
        prompt=request.prompt,
        project_id=request.project_id  # 必须传入
    )
    return {"url": result}
```

## OSS 上传集成

### 服务层实现
```python
from app.services.oss import oss_service

async def generate(self, prompt: str, project_id: str = "") -> str:
    # 调用 API 获取结果
    url = await self._call_api(prompt)
    
    # 如果启用 OSS，上传并返回 OSS URL
    if oss_service.is_enabled():
        oss_url = oss_service.upload_image(url, project_id)
        return oss_url
    
    return url
```

### 重要提醒
- **必须** 在服务层处理 OSS 上传
- **不要** 在路由层重复上传
- **必须** 接收并传递 `project_id` 参数

## 模型参数传递

### 正确方式
从前端获取参数 → 路由层验证 → 服务层使用

### 避免
- 路由层硬编码参数
- 服务层忽略传入的参数
- 前端和后端参数定义不一致
